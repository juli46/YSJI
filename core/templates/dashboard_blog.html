{% extends 'dashboard_base.html' %}
{% block content %}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="container mt-5">

  <!-- Contenedor solo para el formulario -->
  <div class="blog-form-container mb-4">
    <div class="card">
      <div class="card-header">Agregar Blog</div>
      <div class="card-body">
        <form method="post" enctype="multipart/form-data" class="blog-form">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit" class="btn btn-success">Guardar</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Lista de blogs -->
  <div class="card">
    <div class="card-header">Blogs Registrados</div>
    <div class="card-body">
<table class="table">
  <thead>
    <tr>
      <th>#</th>
      <th>Título</th>
      <th>Cuerpo</th>
      <th>Foto</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for blog in blogs %}
    <tr>
      <td>{{ blog.id }}</td>
      <td>{{ blog.titulo }}</td>
      <td>{{ blog.cuerpo|truncatewords:10 }}</td>
      <td>
        {% if blog.foto %}
        <img src="{{ blog.foto.url }}" width="60" />
        {% else %}
        Sin foto
        {% endif %}
      </td>
      <td>
        <a href="{% url 'editar_blog' blog.id %}" class="btn btn-sm btn-primary">Editar</a>
        <a href="{% url 'eliminar_blog' blog.id %}" class="btn btn-sm btn-danger btn-eliminar">Eliminar</a>

          </td>
    </tr>
    {% empty %}
    <tr><td colspan="5">No hay blogs registrados.</td></tr>
    {% endfor %}
  </tbody>
</table>
<style>
  .btn-sm {
  padding: 6px 12px;
  font-size: 0.875rem;
  border-radius: 4px;
  transition: background-color 0.3s ease, color 0.3s ease;
  border: none;
  cursor: pointer;
  display: inline-block;
  text-decoration: none;
  color: white;
}

.btn-primary {
  background-color: #007bff;
}

.btn-primary:hover {
  background-color: #0056b3;
}

.btn-danger {
  background-color: #dc3545;
}

.btn-danger:hover {
  background-color: #a71d2a;
}
.blog-form-container {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
}

.card {
  border: 1px solid #444;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  background-color: #fff;
}

.card-header {
  background-color: #222; /* casi negro */
  color: #eee; /* gris claro */
  font-weight: 600;
  padding: 12px 20px;
  font-size: 1.25rem;
  border-radius: 8px 8px 0 0;
}

.card-body {
  padding: 20px;
}

.blog-form p {
  margin-bottom: 1rem;
  font-family: Arial, sans-serif;
  color: #222;
}

.blog-form label {
  display: block;
  font-weight: 600;
  margin-bottom: 6px;
  color: #333;
}

.blog-form input[type="text"],
.blog-form input[type="file"],
.blog-form textarea,
.blog-form select {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #666;
  border-radius: 5px;
  font-size: 1rem;
  box-sizing: border-box;
  transition: border-color 0.3s ease;
  background-color: #fff;
  color: #222;
}

.blog-form input[type="text"]:focus,
.blog-form input[type="file"]:focus,
.blog-form textarea:focus,
.blog-form select:focus {
  border-color: #000;
  outline: none;
  background-color: #f5f5f5;
}

.btn-success {
  background-color: #000; /* negro */
  border: none;
  padding: 10px 18px;
  font-size: 1rem;
  color: #eee; /* gris claro */
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.btn-success:hover {
  background-color: #444; /* gris oscuro */
}

.table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  color: #222;
}

.table th,
.table td {
  border: 1px solid #444;
  padding: 8px 12px;
  text-align: left;
}

.table thead {
  background-color: #222;
  color: #eee;
}

.table tbody tr:nth-child(even) {
  background-color: #f5f5f5;
}

.table tbody tr:hover {
  background-color: #ddd;
}

img {
  border-radius: 4px;
  border: 1px solid #444;
}
.btn-danger {
  background-color: #c0392b;
  border: none;
  padding: 8px 14px;
  font-size: 0.9rem;
  color: #fff;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.btn-danger:hover {
  background-color: #e74c3c;
}


</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const deleteButtons = document.querySelectorAll('.btn-eliminar');

    deleteButtons.forEach(function(button) {
      button.addEventListener('click', function(e) {
        e.preventDefault();  // Para que no siga el enlace inmediatamente
        const url = this.href;

        Swal.fire({
          title: '¿Estás seguro?',
          text: "¡Esta acción no se puede deshacer!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#dc3545',
          cancelButtonColor: '#6c757d',
          confirmButtonText: 'Sí, eliminar',
          cancelButtonText: 'Cancelar'
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = url;
          }
        });
      });
    });

    // Validación en tiempo real
    const form = document.querySelector('.blog-form');
    const tituloInput = form.querySelector('input[name="titulo"]');
    const cuerpoInput = form.querySelector('textarea[name="cuerpo"]');

    // Crear elementos para mostrar mensajes de error
    const tituloError = document.createElement('div');
    const cuerpoError = document.createElement('div');

    tituloError.style.color = 'red';
    tituloError.style.fontSize = '0.9rem';
    tituloError.style.marginTop = '4px';

    cuerpoError.style.color = 'red';
    cuerpoError.style.fontSize = '0.9rem';
    cuerpoError.style.marginTop = '4px';

    // Insertar mensajes justo después de los inputs
    tituloInput.parentNode.appendChild(tituloError);
    cuerpoInput.parentNode.appendChild(cuerpoError);

    function validateTitulo() {
      const value = tituloInput.value.trim();
      if (value.length === 0) {
        tituloError.textContent = 'El título no puede estar vacío ni solo espacios.';
        return false;
      }
      if (/^\d+$/.test(value)) {
        tituloError.textContent = 'El título no puede contener solo números.';
        return false;
      }
      tituloError.textContent = '';
      return true;
    }

   function validateCuerpo() {
  const value = cuerpoInput.value.trim();

  // Contar caracteres sin espacios
  const nonSpaceChars = value.replace(/\s/g, '');

  if (nonSpaceChars.length < 20) {
    cuerpoError.textContent = 'El cuerpo debe tener al menos 20 caracteres (sin contar espacios).';
    return false;
  }
  if (/^\d+$/.test(nonSpaceChars)) {
    cuerpoError.textContent = 'El cuerpo no puede contener solo números.';
    return false;
  }
  cuerpoError.textContent = '';
  return true;
}
    // Validar en tiempo real cuando el usuario escribe
    tituloInput.addEventListener('input', validateTitulo);
    cuerpoInput.addEventListener('input', validateCuerpo);

    // Validar antes de enviar el formulario
    form.addEventListener('submit', function(e) {
      const isTituloValid = validateTitulo();
      const isCuerpoValid = validateCuerpo();

      if (!isTituloValid || !isCuerpoValid) {
        e.preventDefault();
        Swal.fire('Error', 'Por favor, corrige los errores en el formulario antes de enviarlo.', 'error');
      }
    });
  });
</script>

{% endblock %}
